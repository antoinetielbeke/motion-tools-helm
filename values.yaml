# Default values for motion-tools.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

image:
  repository: devopsansiblede/antragsgruen
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Automatically mount a ServiceAccount's API credentials?
  automount: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}
podLabels: {}

podSecurityContext: {}
  # fsGroup: 33
  # runAsUser: 33
  # runAsGroup: 33
  # runAsNonRoot: true

securityContext: {}
  # capabilities:
  #   drop:
  #     - ALL
  # readOnlyRootFilesystem: false
  # allowPrivilegeEscalation: false

service:
  type: ClusterIP
  port: 80
  targetPort: 80
  annotations: {}
  labels: {}

ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
    # cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: motion.local
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: motion-tools-tls
  #    hosts:
  #      - motion.local

resources:
  limits:
    cpu: 1000m
    memory: 1024Mi
  requests:
    cpu: 250m
    memory: 512Mi

livenessProbe:
  httpGet:
    path: /
    port: http
    scheme: HTTP
  initialDelaySeconds: 60
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
  successThreshold: 1

readinessProbe:
  httpGet:
    path: /
    port: http
    scheme: HTTP
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
  successThreshold: 1

startupProbe:
  httpGet:
    path: /
    port: http
    scheme: HTTP
  initialDelaySeconds: 0
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 30
  successThreshold: 1

# Volume configuration for persistent data
# StatefulSet handles persistence through volumeClaimTemplates
persistence:
  enabled: true
  accessMode: ReadWriteOnce
  size: 10Gi
  storageClass: ""
  annotations: {}
  # Note: existingClaim is not used with StatefulSet
  mountPath: "/var/www/html"
  # subPath: ""

# Motion Tools specific configuration
motionTools:
  # Environment variables for the container
  timezone: "Europe/Amsterdam"

  # Apache FQDN configuration
  apacheFqdn: "motion.local"

  # SMTP Configuration
  # If disabled, local sendmail is used
  # To enable SMTP, uncomment and configure the parameters below
  smtp:
    enabled: false
    # host: "mail.example.com"
    # port: 587
    # from: "motiontool@example.com"
    # user: "motiontool@example.com"
    # Password should be provided via secrets
    # password: ""
    # Use existing secret for SMTP password
    # existingSecret: ""
    # Key in the secret containing the password
    # secretKey: "smtp-password"

  # Additional environment variables
  extraEnvVars: []
  # - name: CUSTOM_VAR
  #   value: "custom-value"

  # Additional environment variables from ConfigMaps or Secrets
  extraEnvFrom: []
  # - configMapRef:
  #     name: my-configmap
  # - secretRef:
  #     name: my-secret

  # Valkey configuration (optional, Redis-compatible)
  # recommended for production
  valkey:
    enabled: false
    host: ""
    port: 6379
    database: 0
    # Password should be provided via secrets
    password: ""
    existingSecret: ""
    secretKey: "valkey-password"

  # JWT configuration (optional)
  jwt:
    enabled: false
    # Private key should be mounted from secret
    privateKeySecret: ""
    privateKeyPath: "/var/www/html/config/jwt.key"

  # Background jobs configuration
  backgroundJobs:
    enabled: false
    notifications: true
    healthCheckKey: ""

  # PDF rendering configuration
  pdfRendering:
    # Options: tcpdf, weasyprint, latex
    engine: "tcpdf"
    weasyprintPath: "/usr/bin/weasyprint"
    lualatexPath: "/usr/bin/lualatex"
    pdfunitePath: "/usr/bin/pdfunite"

  # ImageMagick configuration
  imageMagick:
    enabled: false
    path: "/usr/bin/convert"

# Valkey configuration (Redis-compatible in-memory data store) - CloudPirates chart
valkey:
  enabled: false
  # Number of Valkey replicas
  replicaCount: 1

  # Authentication settings
  auth:
    enabled: true
    password: "changeme"
    # Use existing secret for password
    existingSecret: ""
    existingSecretPasswordKey: "password"

  # Valkey configuration
  config:
    maxMemory: "256mb"
    maxMemoryPolicy: "allkeys-lru"
    save: "900 1 300 10 60 10000"
    extraConfig: []

  # Resource limits and requests
  resources:
    limits:
      memory: 256Mi
      cpu: 250m
    requests:
      memory: 128Mi
      cpu: 100m

  # Persistence configuration
  persistence:
    enabled: true
    storageClass: ""
    size: 8Gi
    accessModes:
      - ReadWriteOnce

  # Service configuration
  service:
    type: ClusterIP
    port: 6379

  # Security context
  podSecurityContext:
    fsGroup: 1000

  securityContext:
    allowPrivilegeEscalation: false
    runAsNonRoot: true
    runAsUser: 999
    runAsGroup: 1000
    readOnlyRootFilesystem: true
    capabilities:
      drop:
        - ALL

# MariaDB configuration (CloudPirates chart)
mariadb:
  enabled: true
  auth:
    enabled: true
    rootPassword: "changeme"
    database: "antragsgruen"
    username: "antragsgruen"
    password: "changeme"
    # Use existing secret for passwords
    existingSecret: ""
    allowEmptyRootPassword: ""
    secretKeys:
      rootPasswordKey: mariadb-root-password
      userPasswordKey: mariadb-password
  persistence:
    enabled: true
    storageClass: ""
    accessModes:
      - ReadWriteOnce
    size: 8Gi
  resources:
    limits:
      memory: 512Mi
      cpu: 500m
    requests:
      memory: 256Mi
      cpu: 250m

# External database configuration (when mariadb.enabled is false)
externalDatabase:
  host: ""
  port: 3306
  database: "antragsgruen"
  username: "antragsgruen"
  password: ""
  existingSecret: ""
  userPasswordKey: "db-password"

# Node selector for pod assignment
nodeSelector: {}

# Tolerations for pod assignment
tolerations: []

# Affinity for pod assignment
affinity: {}

# Additional volumes
extraVolumes: []
# - name: extra-volume
#   configMap:
#     name: extra-configmap

# Additional volume mounts
extraVolumeMounts: []
# - name: extra-volume
#   mountPath: /extra
#   readOnly: true

# Init containers
initContainers: []
# - name: init-db
#   image: busybox:1.35
#   command: ['sh', '-c', 'until nc -z database 3306; do echo waiting for db; sleep 2; done;']

# Sidecar containers
sidecarContainers: []
# - name: sidecar
#   image: busybox:1.35
#   command: ['sh', '-c', 'while true; do echo sidecar; sleep 30; done']

# Network policy
# recommended for production
networkPolicy:
  enabled: false
  policyTypes:
    - Ingress
    - Egress
  ingress: []
  egress: []

# Priority class name
priorityClassName: ""

# Topology spread constraints
topologySpreadConstraints: []

# Update strategy for StatefulSet
# This controls how pods are updated during a rolling update
# For a single-replica StatefulSet, this has minimal impact but is still required
# - type: RollingUpdate - updates pods one at a time
# - partition: 0 - all pods will be updated (in this case, just the one pod)
updateStrategy:
  type: RollingUpdate
  # Note: maxSurge is not available for StatefulSets
  rollingUpdate:
    partition: 0

# Revision history limit
revisionHistoryLimit: 10

# Enable debug mode
debug: false

# Additional labels
labels: {}

# Additional annotations
annotations: {}
